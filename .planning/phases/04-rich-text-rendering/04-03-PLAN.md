---
phase: 04-rich-text-rendering
plan: 03
type: execute
wave: 3
depends_on:
  - 04-01
  - 04-02
files_modified: []
autonomous: false

requirements:
  - RTXT-01
  - RTXT-02
  - RTXT-03
  - RTXT-04

must_haves:
  truths:
    - "All four RTXT requirements are visually confirmed working in the browser"
    - "No regressions in existing mention pills, message sending, or voice features"
  artifacts: []
  key_links: []
---

<objective>
Human verification checkpoint for Phase 4: Rich Text Rendering. Confirms all four RTXT requirements work correctly end-to-end in a live browser session after Plans 01 and 02 execute.

Purpose: Rich text rendering is visual — automated tests verify logic but cannot confirm rendering fidelity or UX. Human review catches layout issues, broken fallbacks, and double-rendering bugs.
Output: Phase 4 approved and complete.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/04-rich-text-rendering/04-01-SUMMARY.md
@.planning/phases/04-rich-text-rendering/04-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Rich text rendering for chat messages:
    - Markdown formatting (bold, italic, inline code, fenced code blocks, lists, blockquotes) rendered as styled HTML via MDEx (RTXT-01)
    - Bare URLs auto-converted to clickable anchor tags (RTXT-02)
    - Image URLs (jpg, jpeg, png, gif, webp, svg) auto-embedded as inline images with broken-image fallback (RTXT-04)
    - Link preview cards showing OG title, description, and thumbnail beneath URL-containing messages (RTXT-03)
  </what-built>
  <how-to-verify>
    Start the server: `mix phx.server` (from the project root)
    Navigate to: http://localhost:4000 and log in, then open any text channel.

    Test each requirement in order:

    **RTXT-01 — Markdown formatting:**
    Send: `**bold text** and _italic text_ and \`inline code\``
    Expected: Bold, italic, and monospace code styling in the message bubble (not raw asterisks/backticks)

    Send:
    ```
    > This is a blockquote
    ```
    Expected: Indented blockquote styling

    Send:
    ```
    - item one
    - item two
    - item three
    ```
    Expected: Bullet list renders correctly

    **RTXT-02 — URL auto-linking:**
    Send: `check out https://elixir-lang.org for more`
    Expected: https://elixir-lang.org appears as a clickable blue underlined link (not plain text)

    **RTXT-04 — Inline image embedding:**
    Send: `https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png`
    Expected: The Google logo image appears inline in the message bubble (max ~400px wide)

    Send a broken image URL: `https://example.com/this-image-does-not-exist-abc123.png`
    Expected: Broken-image placeholder ("Image unavailable" box) appears — NOT a broken browser image icon

    **RTXT-03 — Link preview cards:**
    Send: `https://github.com`
    Expected: Within ~5 seconds, a preview card appears below the message showing GitHub's title and description. May include a thumbnail image.

    Send a non-existent URL: `https://this-domain-does-not-exist-xyz123456.com`
    Expected: No preview card appears — message renders normally with no error

    **Regression check — Mentions still work:**
    Send: `@everyone **meeting now**`
    Expected: @everyone mention pill renders AND "meeting now" is bold — both in same message

    **XSS check (optional but recommended):**
    Send: `<script>alert(1)</script>`
    Expected: The text appears as escaped literal characters — no alert dialog fires
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe which items failed</resume-signal>
</task>

</tasks>

<verification>
All four RTXT success criteria from ROADMAP.md confirmed by human review:
1. Messages render markdown formatting including bold, italic, code blocks, lists, and blockquotes
2. URLs in messages are automatically converted to clickable links
3. URLs display a preview card showing title, description, and thumbnail (Open Graph)
4. Image URLs display inline as embedded images in the message feed
</verification>

<success_criteria>
Human approves all RTXT-01 through RTXT-04 behaviors as working correctly. Phase 4 complete.
</success_criteria>

<output>
After approval, create `.planning/phases/04-rich-text-rendering/04-03-SUMMARY.md` recording:
- Checkpoint approved/rejected and by whom
- Any issues found and whether they were fixed inline or deferred
- Phase 4 completion date
</output>
